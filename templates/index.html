<!DOCTYPE html>
<html>
<head>
    <title>GIS Cost Automation Workflows</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 1000px; margin: auto; }
        input, textarea { width: 100%; box-sizing: border-box; }
        .output { background: #f1f1f1; padding: 15px; margin-top: 20px; border-radius: 6px; }
        .error { color: red; margin-top: 18px; margin-bottom: 18px; font-weight: 600; }
        .photo { margin-bottom: 20px; text-align: center; }
        .photo img {
            max-width: 800px;
            height: auto;
            border-radius: 8px;
            border: 2px solid black;
        }
        label { font-weight: bold; }
        .case-code-block {
            background: #272822;
            color: #f8f8f2;
            padding: 18px;
            font-family: 'Consolas', 'Monaco', 'Menlo', monospace;
            border-radius: 6px;
            font-size: 1em;
            margin-top: 20px;
            white-space: pre;
            overflow-x: auto;
            max-height: 600px;
        }
        .copy-btn {
            margin: 10px 0 16px 0;
            padding: 7px 20px;
            background: #378AD5;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        .copy-btn:active {
            background: #295e88;
        }
        ul {
            margin: 8px 0 0 20px;
            padding-left: 16px;
        }
    </style>
    <script>
        function copyCodeBlock() {
            var code = document.getElementById("caseCodeBlock");
            if (code) {
                var text = code.innerText || code.textContent;
                navigator.clipboard.writeText(text)
                    .then(() => { alert("CASE statement copied to clipboard!"); });
            }
        }
    </script>
</head>
<body>
    <div class="container">

        <h2>Upload Excel & Specify Parameters</h2>
        <div class="photo">
            <img src="{{ url_for('static', filename='ExcelPicture.png') }}" alt="Excel Example">
        </div>

        <form method="POST" enctype="multipart/form-data">
            <label for="excel_file">Formatted Excel file:</label> <br>
            <input type="file" name="excel_file" accept=".xlsx,.xls" required><br><br>

            <label for="layer_name">Layer Name (used in code output):</label> <br>
            <input type="text" name="layer_name" placeholder="e.g. Trackers_Layer" required><br><br>

            <label for="required_columns">Required Parameters/Columns (comma-separated, <strong>do not include 'COST'</strong>):</label> <br>
            <input type="text" name="required_columns" placeholder="e.g. SOIL_ZONE, TRACKERTYP, HWL_OPT" required><br><br>

            <label for="subtract_value">Subtract value from sum (default 0):</label> <br>
            <input type="number" step="any" name="subtract_value" placeholder="0"><br><br>

            <button type="submit">Submit</button>
        </form>

        {% if error_msg %}
            <div class="error">{{ error_msg }}</div>
        {% endif %}

        {% if missing_value_lines %}
            <div class="error">
                Some rows in your Excel file have missing values:
                <ul>
                {% for col, rows in missing_value_lines %}
                    <li>
                        <strong>"{{ col }}"</strong> missing values in row(s): {{ rows | join(', ') }}
                    </li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if case_code %}
            <div class="output">
                <h3>Generated Statement Code</h3>
                <button type="button" class="copy-btn" onclick="copyCodeBlock()">Copy to Clipboard</button>
                <pre class="case-code-block" id="caseCodeBlock">{{ case_code }}</pre>
            </div>
        {% endif %}

    </div>
</body>
</html>
